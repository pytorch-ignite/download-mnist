name: Tests

on: [push]

jobs:
  gha:
    runs-on: ${{ matrix.os }}
    strategy:
      fail-fast: false
      matrix:
        os: [ubuntu-latest]

    steps:
      - uses: actions/checkout@v2

      - name: Install Python
        uses: actions/setup-python@v2
        with:
          python-version: 3.7

      - name: Run Action
        uses: ./
        with:
          target_dir: /tmp

      - name: Check Content 
        run: ls -R ${INPUT_TARGET_DIR}/MNIST

  cci:
    runs-on: ${{ matrix.os }}
    strategy:
      fail-fast: false
      matrix:
        os: [ubuntu-latest]

    steps:
      - name: Install Python
        uses: actions/setup-python@v2
        with:
          python-version: 3.7

      - name: Install Dependencies
        run: pip install torch==1.9.0+cpu torchvision==0.10.0+cpu torchaudio==0.9.0 -f https://download.pytorch.org/whl/torch_stable.html

      - name: Run Action
        run: git clone https://github.com/pytorch-ignite/download-mnist-github-action.git /tmp/MNIST/raw

      - name: Check Content
        run: ls -R /tmp/MNIST/raw
        
      - name: Run Tests
        run: python -c "from torchvision.datasets.mnist import MNIST; MNIST('/tmp')"
